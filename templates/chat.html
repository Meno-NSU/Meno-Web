<!DOCTYPE html>
<html lang="ru" xmlns:hx-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>RAG-–ß–∞—Ç</title>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<header class="topbar">
    <img src="/static/meno-icon.jpg" alt="–ò–∫–æ–Ω–∫–∞" class="topbar-icon">
    <span class="topbar-title">–ú–µ–Ω–æ–Ω</span>
</header>
<div class="container">
    <div class="chat">
        <div id="messages" class="messages" hx-target="this" hx-swap="innerHTML">
            {% include "components/messages.html" %}
        </div>
    </div>
</div>
<button id="scroll-down-btn" class="scroll-down-btn" onclick="scrollToBottom()">‚ñº</button>
<script>
    const scrollBtn = document.getElementById('scroll-down-btn');
    const messages = document.getElementById('messages');

    function scrollToBottom() {
        messages.scrollTop = messages.scrollHeight;
    }

    // –°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    messages.addEventListener('scroll', () => {
        const delta = messages.scrollHeight - messages.scrollTop - messages.clientHeight;
        scrollBtn.style.display = delta > 50 ? 'block' : 'none';
    });

    // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', scrollToBottom);

    // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ htmx
    document.body.addEventListener("htmx:afterSwap", (e) => {
        if (e.target.id === "messages") {
            scrollToBottom();
        }
    });
</script>
<div class="input-area">
    <form class="input-bar"
          hx-post="/send"
          hx-target="#messages"
          hx-swap="innerHTML"
          hx-on::after-request="this.querySelector('input').value='';">
        <input type="text" name="message" id="input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
    <form
            hx-post="/clear"
            hx-target="#messages"
            hx-swap="innerHTML"
            class="clear-form"
    >
        <button type="submit" class="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
    </form>
</div>

</body>
</html>
